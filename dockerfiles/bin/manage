#!/bin/bash

case "$1" in
  start)
    chown -R postgres:postgres /var/lib/postgresql/9.3/main
    chmod -R 700 /var/lib/postgresql/9.3/main
    su postgres -c "/usr/lib/postgresql/9.3/bin/postgres -D /var/lib/postgresql/9.3/main -c config_file=/etc/postgresql/9.3/main/postgresql.conf"
  ;;

  create)
    name=$2
    database_pw=$3
    su - postgres -c "psql --command \"CREATE USER $name WITH PASSWORD '$database_pw';\""
    su - postgres -c "createdb -E utf8 -O $name $name"
    su - postgres -c "psql --command \"GRANT ALL PRIVILEGES ON DATABASE $name TO $name;\""
  ;;

  delete)
    name=$2
    su - postgres -c "dropdb $name"
    su - postgres -c "dropuser $name"
  ;;

  admin_console)
    su - postgres -c psql
  ;;

  list)
    su - postgres -c "psql --command \"\\l\""
  ;;

  dump)
    name=$2
    passwd=$3
    PGPASSWORD="$passwd" pg_dump -Fc --no-acl --no-owner -h localhost -U $name -w $name
  ;;

  restore)
    name=$2
    passwd=$3
    PGPASSWORD="$passwd" pg_restore -h localhost -cO -d $name -U $name -w
  ;;
  console)
    name=$2
    database_pw=$3
    PGPASSWORD="$database_pw" psql -h localhost -U $name $name
  ;;
  bash)
    bash
  ;;
  cmd)
    bash -c "$2"
  ;;
esac
